# Flussonic: Тестовое задание

## Описание

Существует несколько типов периодов:
- `daily` - дневной (продолжительность - 1 день)
- `monthly` - месячный (продолжительность - 1 месяц)
- `annually` - годовой (продолжительность - 1 год)

У каждого из типов периодов существует однозначный идентификатор `id` (`String`), который используется для сериализации и десериализации конкретного периода. На вход и на выход программы передаются исключительно идентификаторы.
- `daily` - `"#{year}M#{month}D#{day}"` (прим: `"2023M2D28"` - интервал _28.02.2023 - 01.03.2023_)
- `monthly` - `"#{year}M#{month}"` (прим: `"2023M2"` - интервал _01.02.2023 - 01.03.2023_)
- `annually` - `"#{year}"` (прим: `"2023"` - интервал _01.01.2023 - 31.12.2023_)

Периоды (кроме типа `daily`) могут иметь сдвиг.
- `daily` период может начинаться только в день, обозначенный в идентификаторе (например, `"2023M2D28"` начинается строго _28.02.2023_ и заканчивается строго _01.03.2023_)
- `monthly` период может начинаться только рамках года и месяца из идентификатора (например, `"2023M2"` может начинаться _01.02.2023..28.02.2023_), дата конца интервала при этом соответственно сдвигается.
- `annually` период может начинаться только рамках года из идентификатора (например, `"2023"` может начинаться _01.01.2023..31.12.2023_), дата конца интервала при этом соответственно сдвигается.

Периоды могут образовывать _цепочки_ (последовательность периодов).
Цепочка считается _корректной_, если соблюдено условие: дата начала каждого периода должна быть равна дате конца предыдущего периода.

У всей цепочки периодов также есть определенная дата начала (`start_date`).
В соответствии с этой датой интервалы периодов внутри цепочки должны сдвигаться. При этом, если сдвиг больше, чем доступно в периоде, то интервал периода начинается/заканчивается на крайней доступной дате. Также, `daily` период меняет сдвиг цепочки для периодов, стоящих после него, на дату конца своего интервала.

### Пример работы

Дана цепочка:

`start_date` = _30.01.2023_

`periods` = `["2023M1D30", "2023M1", "2023M2", "2023", "2024M3", "2024M4D30", "2024M5"]`

Интервалы периодов, которые в нее входят:
- `"2023M1D30"`: _30.01.2023..31.01.2023_ - `daily` период поменял сдвиг с 30 до 31 (по дате конца).
- `"2023M1"`: _31.01.2023..28.02.2023_ - до **28.02**, т.к. сдвиг больше последнего доступного дня периода.
- `"2023M2"`: _28.02.2023..31.03.2023_ - от **28.02**, т.к. сдвиг больше последнего доступного дня периода; до **31.03**, т.к. сдвиг 31 и 31.03.2023 - существующая дата.
- `"2023"`: _31.03.2023..31.03.2024_
- `"2024M3"`: _31.03.2024..30.04.2024_ - от **31.03**, т.к. сдвиг 31; до **30.04**, т.к. сдвиг больше последнего доступного дня периода.
- `"2024M4D30"`: _30.04.2024..01.05.2024_ - `daily` период поменял сдвиг с 31 до 1 (по дате конца).
- `"2024M5"`: _01.05.2024..01.06.2024_

## Задание

Написать программу, которая:
- Проверяет, что заданная цепочка периодов корректна.

Пример кода:
```ruby
periods_chain   # Заданная цепочка периодов

periods_chain.valid? #=> true
```

- (**\***_доп. задание_) Позволяет добавлять к концу цепочки новый период с заданным типом.

Пример кода:
```ruby
periods_chain   #=> [2023M1, 2023M2]
new_period_type # Тип периода, который требуется добавить ("daily"/"monthly"/"annually")
#=> "monthly"

periods_chain.add(new_period_type) # Новая цепочка, в которую добавлен период с переданным типом
#=> [2023M1, 2023M2, 2023M3]
```

## Примеры входных и выходных данных

| start_date |                               periods                               |  valid?  |
|------------|---------------------------------------------------------------------|----------|
| 16.07.2023 | `["2023", "2024", "2025"]`                                          | `true`   |
| 24.04.2023 | `["2023", "2025", "2026"]`                                          | `false`  |
| 31.01.2023 | `["2023M1", "2023M2", "2023M3"]`                                    | `true`   |
| 10.01.2023 | `["2023M1", "2023M3", "2023M4"]`                                    | `false`  |
| 04.06.1976 | `["1976M6D4", "1976M6D5", "1976M6D6"]`                              | `true`   |
| 02.05.2023 | `["2023M5D2", "2023M5D3", "2023M5D5"]`                              | `false`  |
| 30.01.2023 | `["2023M1", "2023M2", "2023M3D30"]`                                 | `true`   |
| 31.01.2023 | `["2023M1", "2023M2", "2023M3D30"]`                                 | `false`  |
| 30.01.2020 | `["2020M1", "2020", "2021", "2022", "2023", "2024M2", "2024M3D30"]` | `true`   |
| 30.01.2020 | `["2020M1", "2020", "2021", "2022", "2023", "2024M2", "2024M3D29"]` | `false`  |
